<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
        <title>Drug interactions</title>
        <!-- Initialize a global WBK function -->
        <script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikibase-sdk.min.js"></script>
        <!-- Initialize a global wdk object using the WBK object -->
        <script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikidata-sdk.min.js"></script>
        <!-- Include the myscipt.js file in this html file -->
        <script src="script.js"></script>
        <script src="https://d3js.org/d3.v4.js"></script>
    </head>

    <body>
      <div class="">
        <h1>Wlecome</h1>
        <p>The purpose of thisproject is to provide a simple service for medical personnel </p>
      </div>

      <div class="information">
        <form id="patientInfo">
          <select id="condition" name="Patient Condition">
            <option value="Q81938" selected>Pain</option>
            <option value="Q42844">Major Depressive Disorders</option>
            <option value="Q544006">Anxiety Disorder</option>
            <option value="Q190805">Heart Disease</option>
            <option value="Q124407">Type 1 Diabetes</option>
            <option value="Q3025883">Type 2 Diabetes</option>
            <option value="Q12192">Pneumonia</option>
          </select>

          <select id="drug" name="Drug in Patients Blood">
            <option value="D07286" selected>Heroin</option>
            <option value="D00110">Cocaine</option>
            <option value="D08187">Methamphetamine</option>
            <option value="D08098">Ketamine</option>
            <option value="D11172">MDMA</option>
            <option value="D10915">Marijuana</option>
            <option value="C07576">Psilocybin</option>
            <option value="D00225">Xanax</option>
          </select>
        </form>
      </div>
        <pre id="output1"></pre>
        <pre id="output2"></pre>
        <pre id="output3"></pre>

        <script>
          var con = document.getElementById('condition');
          var condition = con[con.selectedIndex].value;

          var dru = document.getElementById('drug');
          var drug = dru[dru.selectedIndex].value;


        </script>
        <div id="my_dataviz">
            <script>
                GetData(wbk_bio,condition,drug).then(
                function(value){
                    
                    var dataset = value;
                    var max = value.length-1;
                    
                    data = {};
                    data.nodes = dataset.map(function(item){
                        return {"id": item.keggid, "name": item.label_s}})
                    data.links = dataset.map(function(item){
                        if (item.pathway == dataset[max].pathway) {
                            return {"source": dataset[max].keggid, "target":item.keggid}
                        }
                        else{
                            return {"source": dataset[max].keggid, "target": dataset[max].keggid}
                        }
                        });
                        
                    
                    console.log(data)
                    var margin = {top: 10, right: 30, bottom: 30, left: 40},
                      width = 1280 - margin.left - margin.right,
                      height = 720 - margin.top - margin.bottom;
                    
                    
                    var svg = d3.select("#my_dataviz")
                      .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom)
                      .append("g")
                      .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
                      
                    var link = svg
                      .selectAll("line")
                      .data(data.links)
                      .enter()
                      .append("line")
                        .style("stroke", "#aaa")
                        
                    var node = svg
                      .selectAll("circle")
                      .data(data.nodes)
                      .enter()
                      .append("circle")
                        .attr("r", 10)
                        .style("fill", "#69b3a2")
                    
                    var simulation = d3.forceSimulation(data.nodes)                 // Force algorithm is applied to data.nodes
                      .force("link", d3.forceLink()                               // This force provides links between nodes
                            .id(function(d) { return d.id; })                     // This provide  the id of a node
                            .links(data.links)
                            // and this the list of links
                      )
                      .force("charge", d3.forceManyBody().strength(-9))         // This adds repulsion between nodes. Play with the -400 for the repulsion strength
                      .force("center", d3.forceCenter(width / 2, height / 2))     // This force attracts nodes to the center of the svg area
                      .on("end", ticked);
                      
                      function ticked() {
                        link
                          .attr("x1", function(d) { return d.source.x; })
                          .attr("y1", function(d) { return d.source.y; })
                          .attr("x2", function(d) { return d.target.x; })
                          .attr("y2", function(d) { return d.target.y; });
                  
                        node
                           .attr("cx", function (d) { return d.x+6; })
                           .attr("cy", function(d) { return d.y-6; });
                      }    
                },
                function(error){console.log(error);});
            </script>
        </div>
        
    </body>
</html>
